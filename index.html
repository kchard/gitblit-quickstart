<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="gitblit-quickstart : Getting started with Gitblit - Configuring Gitblit as a service with runit " />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>gitblit-quickstart</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/kchard/gitblit-quickstart">View on GitHub</a>

          <h1 id="project_title">gitblit-quickstart</h1>
          <h2 id="project_tagline">Getting started with Gitblit - Configuring Gitblit as a service with runit </h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/kchard/gitblit-quickstart/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/kchard/gitblit-quickstart/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a name="abstract" class="anchor" href="#abstract"><span class="octicon octicon-link"></span></a>Abstract</h3>

<p>The purpose of this tutorial is to get you up and running with Gitbllit as quickly as possible. Gitblit is an open-source, pure Java stack for managing, viewing, and serving Git repositories. In this tutorial we will setup a stock Gitblit installation using runit for service management.</p>

<h3>
<a name="what-you-will-learn" class="anchor" href="#what-you-will-learn"><span class="octicon octicon-link"></span></a>What You Will Learn</h3>

<ol>
<li>How to install Gitblit</li>
<li>How to setup runit to manage Gitblit</li>
</ol><h3>
<a name="0-prerequisites" class="anchor" href="#0-prerequisites"><span class="octicon octicon-link"></span></a>0. Prerequisites</h3>

<p>Make sure that you java Java installed on your system. To verify that Java is installed execute the command:</p>

<pre><code># java -version
</code></pre>

<p>You should see some output that looks something like this:</p>

<pre><code>java version "1.7.0_25"
OpenJDK Runtime Environment (IcedTea 2.3.10) (7u25-2.3.10-1~deb7u1)
OpenJDK Client VM (build 23.7-b01, mixed mode, sharing)
</code></pre>

<p>If you see an error, consult the documentation on how to install Java for your platform.</p>

<p>Additionally, you will need <code>runit</code> installed. If you are unfamiliar with <code>runit</code>, you may want to read the following tutorial before continuing. </p>

<p><a href="http://kchard.github.io/runit-quickstart/">Getting started with the runit - a UNIX init scheme with service supervision</a></p>

<h3>
<a name="1-installing-gitblit" class="anchor" href="#1-installing-gitblit"><span class="octicon octicon-link"></span></a>1. Installing Gitblit</h3>

<p>The first thing that we need to do is create a user to run Gitblit with. Add a new user named <code>gitblit</code> using the method provided by your Linux distribution. For example, on Debain you can add the user with the the following command:</p>

<pre><code># adduser gitblit
</code></pre>

<p>Next, let's create a directory to install Gitblit in and change its ownership to the <code>gitblit</code> user. You can install Gitblit in any location you wish. I like to install it in the <code>/opt</code> directory. </p>

<pre><code># mkdir /opt/gitblit
# chown gitblit:gitblit /opt/gitblit
</code></pre>

<p>The only artifact that we need to install Gitbllit is the GO archive downloaded from the <a href="http://gitblit.com/">Gitblit Website</a>. </p>

<p>Change to the <code>gitblit</code> user, navigate to the Gitblit installation directory, and download the zip.
As of this writing the latest version is 1.3.2.</p>

<pre><code># su gitblit
# cd /opt/gitblit
# wget http://gitblit.googlecode.com/files/gitblit-1.3.2.zip
</code></pre>

<p>Gitblit is provided as an executable jar with an embedded web server. There is no need to deploy the war in a servlet container such as Tomcat. </p>

<p>By default Gitblit will only be available on the local server over SSL on port 8443. In order to access Gitblit from another server, we need to tell it to accept connections on interfaces besides localhost. If you would like to access Gitblit over a standard HTTP connection make the following changes in <code>/opt/gitblit/data/gitblit.properties</code>.</p>

<pre><code>server.httpPort = 8080
server.httpBindInterface =
</code></pre>

<p>If you would like to access Gitblit over HTTPS then make the following changes in <code>/opt/gitblit/data/gitblit.properties</code>.</p>

<pre><code>server.httpsPort = 8443
server.httpsBindInterface =
</code></pre>

<p>Start Gitblit by running the following command:</p>

<pre><code># java -jar gitblit.jar
</code></pre>

<p>You should see output displaying the progress of Gitblitstarting up. Once it is started, open a web browser and navigate to port 8080 on your host, you should be greeted by the Gitblit home page. Take a few minutes to explore the application.</p>

<p>When you are done exploring Gitblit, go ahead and shut it down by entering <code>Ctrl-c</code> in the terminal. </p>

<h3>
<a name="2-configuring-runit-to-manage-gitblit" class="anchor" href="#2-configuring-runit-to-manage-gitblit"><span class="octicon octicon-link"></span></a>2. Configuring runit to manage Gitblit</h3>

<p>While the steps described above are great to fire up Gitblit and start exploring, when deploying Gitblit for use in production this simple approach has several issues. First, to ensure high availability of our git repository server we need a way to automate the management of the Gitblit process. Second, we need a way to manage logging. By configuring Gitblit as a managed service with <code>runit</code>, we can take care of both of these concerns.</p>

<p>If you are still acting as the <code>gitblit</code> user, revert back to <code>root</code> so that we can configure <code>runit</code> to monitor Gitblit.</p>

<p>First create a staging directory for our runit configuration by executing the following command :</p>

<pre><code># mkdir -p /etc/runit/gitblit
</code></pre>

<p>Create a script named <code>run</code> in the new directory with the following contents:</p>

<pre><code>#!/bin/sh -e
cd /opt/gitblit
exec 2&gt;&amp;1
exec chpst -u gitblit java -jar gitblit.jar
</code></pre>

<p>Now make the script executable.</p>

<pre><code># chmod +x /etc/runit/gitblit/run
</code></pre>

<p>The only thing left to do is configure logging for the service. First create the logging configuration by making a <code>log</code> sub directory under <code>/ect/runit/gitblit</code>.</p>

<pre><code># mkdir /etc/runit/gitblit/log
</code></pre>

<p>Next, create a script named <code>run</code> in the <code>log</code> directory with the following contents:</p>

<pre><code>#!/bin/sh
exec chpst -u gitblit svlogd -tt /opt/gitblit/logs
</code></pre>

<p>Make the script executable.</p>

<pre><code># chmod +x /etc/runit/gitblit/log/run
</code></pre>

<p>The <code>/opt/gitblit/logs</code> directory does not exit, so create it and change its ownership to the <code>gitblit</code> user.</p>

<pre><code># mkdir /opt/gitblit/logs
# chown gitblit:gitblit /opt/gitblit/logs
</code></pre>

<p>That is all of the configuration that we need to address process management and logging. Go ahead and deploy the service by creating a symbolic link from the <code>/etc/service/gitblit</code> directory to our staging directory.</p>

<pre><code># ln -s /etc/runit/gitblit /etc/service/gitblit
</code></pre>

<p>If everything worked, you should see information being written to the logs and Gitblit should be available on port 8080. Please take some time to review the basics of <code>runit</code> if you are not clear on what we just setup. </p>

<h3>
<a name="start-commiting-code" class="anchor" href="#start-commiting-code"><span class="octicon octicon-link"></span></a>Start Commiting Code!!!</h3>

<p>At this point you have everything you need to setup a monitored Gitblit server with logging. Your next step should be to read the Gitblit documentation to configure Gitblit to suit your needs. A good place to start is the "Gitblit Administration" page.</p>

<p><a href="http://gitblit.com/administration.html">http://gitblit.com/administration.html</a></p>

<h3>
<a name="contact-me" class="anchor" href="#contact-me"><span class="octicon octicon-link"></span></a>Contact Me</h3>

<p>If you have any questions or would like further clarification, please feel free to shoot me an email. I would be glad to help. </p>

<p>Kevin</p>

<p><a href="mailto:krchard@gmail.com">krchard@gmail.com</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">gitblit-quickstart maintained by <a href="https://github.com/kchard">kchard</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
